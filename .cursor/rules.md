# AI-Powered Personalized Restaurant Advisor - Project Rules

## ğŸ¯ Project Overview

- **Goal**: AI-based restaurant recommendation system for travelers
- **Architecture**: Next.js 15 + React 19 + TypeScript + Tailwind CSS + shadcn/ui
- **Structure**: Single-page MVP (SPA-like with SSR benefits)

## ğŸ› ï¸ Technology Stack

### Core Framework

- **Next.js 15.5.6**: React framework with App Router
- **React 19.1.0**: Latest React with concurrent features
- **TypeScript 5**: Type-safe JavaScript development

### Styling & UI

- **Tailwind CSS 4**: Utility-first CSS framework
- **shadcn/ui**: Component library with Radix UI primitives
- **Lucide React**: Icon library
- **Class Variance Authority**: Component variant management

### Development Tools

- **ESLint**: Code linting with Next.js config
- **Prettier**: Code formatting
- **Turbopack**: Fast bundler for development

### Key Dependencies

- **@radix-ui/react-select**: Accessible select component
- **@radix-ui/react-slot**: Composition primitive
- **clsx**: Conditional className utility
- **tailwind-merge**: Tailwind class merging utility
- **tw-animate-css**: Tailwind animation utilities

### Build & Development

- **Turbopack**: Fast development server
- **TypeScript**: Strict mode enabled
- **ESLint + Prettier**: Code quality and formatting

### Package Manager

- **pnpm**: Fast, disk space efficient package manager
- **Lock file**: pnpm-lock.yaml for dependency version control

### Configuration Files

- **components.json**: shadcn/ui configuration
- **tsconfig.json**: TypeScript configuration
- **eslint.config.mjs**: ESLint configuration
- **.prettierrc**: Prettier configuration
- **postcss.config.mjs**: PostCSS configuration

## ğŸ“ Folder Structure Rules

### Current Structure (After Refactoring)

```
src/
â”œâ”€â”€ app/                # ğŸ¯ Next.js App Router (routing, pages, API routes)
â”‚   â”œâ”€â”€ api/           # API Routes (server endpoints)
â”‚   â”œâ”€â”€ api-client/    # Client-side API wrappers (fetch calls)
â”‚   â”œâ”€â”€ components/     # App-specific components
â”‚   â”œâ”€â”€ data/          # Static data and mocks
â”‚   â”œâ”€â”€ hooks/         # App-specific custom hooks
â”‚   â”œâ”€â”€ types/         # App-specific types
â”‚   â”œâ”€â”€ layout.tsx     # Root layout
â”‚   â”œâ”€â”€ page.tsx       # Main page
â”‚   â””â”€â”€ globals.css    # Global styles
â”œâ”€â”€ components/        # ğŸŒ Shared UI components (shadcn/ui only)
â”‚   â””â”€â”€ ui/            # shadcn/ui components (do not modify directly)
â”œâ”€â”€ lib/               # ğŸŒ External services & server logic
â”‚   â”œâ”€â”€ server/        # Server-side business logic (API routes only)
â”‚   â”œâ”€â”€ googlePlaces.ts
â”‚   â”œâ”€â”€ mapbox.ts
â”‚   â”œâ”€â”€ openAI.ts
â”‚   â”œâ”€â”€ prisma.ts
â”‚   â””â”€â”€ utils.ts       # UI utilities (cn function)
â””â”€â”€ utils/             # ğŸŒ Generic utilities
    â””â”€â”€ promise.ts     # Promise utilities
```

### Key Principles

1. **Client/Server Separation**: 
   - `app/api-client/` = Browser-side API calls (client components only)
   - `lib/server/` = Server-side business logic (API routes only)
   - `app/api/` = Next.js API Routes (server endpoints)

2. **Component Organization**:
   - `app/components/` = All app-specific components
   - `components/ui/` = Pure UI library (shadcn components only)

3. **Data Organization**:
   - `app/data/constants/` = Static constants
   - `app/data/mocks/` = Mock/test data

### Component Classification Rules

#### Shared UI Components (`src/components/ui/`)

- **Purpose**: Pure UI library components (shadcn/ui)
- **Examples**: Button, Card, Dialog, Select
- **Location**: `src/components/ui/`
- **Important**: Auto-generated by shadcn/ui, do not modify directly
- **Usage**: Import from `@/components/ui/[component]`

#### App-Specific Components (`src/app/components/`)

- **Purpose**: All Foondo app-specific components
- **Organization**: Feature-based folders
  - `layout/` - Layout components (Funnel, ProgressPanel)
  - `search/` - Search flow components (CitySelector, FoodSelector, etc.)
  - `results/` - Results display components (RestaurantCard, RecommendationsResult, etc.)
- **Examples**: CitySelector, RestaurantCard, RecommendationProgress
- **Location**: `src/app/components/[feature]/[Component].tsx`

### Folder Role Definitions

#### `src/app/api/` (Next.js API Routes - Server Endpoints)

```
app/api/
â”œâ”€â”€ cities/
â”‚   â”œâ”€â”€ route.ts         # POST /api/cities
â”‚   â””â”€â”€ [id]/route.ts    # GET /api/cities/[id]
â”œâ”€â”€ foods/
â”‚   â””â”€â”€ route.ts         # POST /api/foods
â””â”€â”€ restaurants/
    â””â”€â”€ recommendations/
        â””â”€â”€ route.ts     # POST /api/restaurants/recommendations
```

- **Purpose**: Server-side API endpoints
- **Usage**: Only in server-side code (API routes)
- **Access**: HTTP requests from client or server

#### `src/app/api-client/` (Client-Side API Wrappers)

```
app/api-client/
â”œâ”€â”€ cities.ts            # cityApi() - calls /api/cities
â”œâ”€â”€ foods.ts             # foodApi() - calls /api/foods
â””â”€â”€ recommendations.ts   # recommendationApi() - calls /api/restaurants/recommendations
```

- **Purpose**: Browser-side API call wrappers
- **Usage**: Only in client components/hooks
- **Pattern**: `*Api()` function naming (e.g., `cityApi()`, `foodApi()`)
- **Files**: REST convention naming (e.g., `cities.ts`, `foods.ts`)

#### `src/app/components/` (App-Specific Components)

```
app/components/
â”œâ”€â”€ layout/              # Layout components
â”‚   â”œâ”€â”€ Funnel.tsx
â”‚   â””â”€â”€ ProgressPanel.tsx
â”œâ”€â”€ search/              # Search flow components
â”‚   â”œâ”€â”€ CitySelector.tsx
â”‚   â”œâ”€â”€ FoodSelector.tsx
â”‚   â”œâ”€â”€ PrioritySelector.tsx
â”‚   â””â”€â”€ ...
â””â”€â”€ results/             # Results display components
    â”œâ”€â”€ RestaurantCard.tsx
    â”œâ”€â”€ RecommendationsResult.tsx
    â””â”€â”€ ...
```

- **Purpose**: All Foondo app-specific components
- **Organization**: Feature-based folders
- **Usage**: Import from `@/app/components/[feature]/[Component]`

#### `src/components/ui/` (Shared UI Library)

```
components/ui/
â”œâ”€â”€ button.tsx
â”œâ”€â”€ card.tsx
â”œâ”€â”€ command.tsx
â”œâ”€â”€ dialog.tsx
â””â”€â”€ select.tsx
```

- **Purpose**: shadcn/ui components (pure UI library)
- **Important**: Do not modify directly (shadcn/ui managed)
- **Usage**: Import from `@/components/ui/[component]`

#### `src/lib/` (External Services & Server Logic)

```
lib/
â”œâ”€â”€ server/              # Server-side business logic
â”‚   â”œâ”€â”€ aiFoodService.ts
â”‚   â”œâ”€â”€ aiReviewService.ts
â”‚   â””â”€â”€ restaurantService.ts
â”œâ”€â”€ googlePlaces.ts      # Google Places API client
â”œâ”€â”€ mapbox.ts            # Mapbox API client
â”œâ”€â”€ openAI.ts            # OpenAI API client
â”œâ”€â”€ prisma.ts            # Prisma client
â””â”€â”€ utils.ts             # UI utilities (cn function)
```

- **Purpose**: External service integrations and server-side logic
- **`lib/server/`**: Server-only business logic (used in API routes)
- **Other files**: External API clients and utilities

#### `src/app/data/` (Static Data)

```
app/data/
â”œâ”€â”€ constants/           # Static constants
â”‚   â”œâ”€â”€ foods.ts         # COMMON_FOODS
â”‚   â””â”€â”€ priorities.ts    # PRIORITY_ITEMS
â””â”€â”€ mocks/              # Mock/test data
    â””â”€â”€ mockRecommendations.ts
```

- **Purpose**: Static data and mock data
- **Organization**: `constants/` for production data, `mocks/` for test data

#### `src/app/hooks/` (App-Specific Hooks)

```
app/hooks/
â”œâ”€â”€ useCity.ts
â”œâ”€â”€ useFood.ts
â”œâ”€â”€ useFunnel.ts
â”œâ”€â”€ usePrioritySelection.ts
â”œâ”€â”€ useRecommendation.ts
â”œâ”€â”€ useRecommendationFlow.ts
â””â”€â”€ useSearchFlow.ts
```

- **Purpose**: Foondo app-specific custom hooks
- **Usage**: Import from `@/app/hooks/[hook]`

#### `src/app/types/` (App-Specific Types)

```
app/types/
â”œâ”€â”€ city.ts
â”œâ”€â”€ food.ts
â”œâ”€â”€ recommendations.ts
â”œâ”€â”€ restaurant.ts
â””â”€â”€ search.ts
```

- **Purpose**: Foondo app-specific TypeScript types
- **Usage**: Import from `@/app/types/[type]`

#### `src/utils/` (Generic Utilities)

```
utils/
â””â”€â”€ promise.ts           # Promise utilities (withTimeout)
```

- **Purpose**: Generic utility functions (browser/server agnostic)
- **Usage**: Import from `@/utils/[utility]`

## ğŸ”§ Coding Rules

### Import Path Rules

```typescript
// Shared UI components (shadcn/ui)
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

// App-specific components
import { CitySelector } from '@/app/components/search/CitySelector';
import { RestaurantCard } from '@/app/components/results/RestaurantCard';
import { FunnelComponent } from '@/app/components/layout/Funnel';

// Client-side API wrappers (browser only)
import { cityApi } from '@/app/api-client/cities';
import { foodApi } from '@/app/api-client/foods';
import { recommendationApi } from '@/app/api-client/recommendations';

// Server-side business logic (API routes only)
import { restaurantService } from '@/lib/server/restaurantService';
import { aiFoodService } from '@/lib/server/aiFoodService';

// External service clients
import { searchLocations } from '@/lib/mapbox';
import { openGoogleMaps } from '@/lib/googlePlaces';

// App-specific hooks
import { useCity } from '@/app/hooks/useCity';
import { useSearchFlow } from '@/app/hooks/useSearchFlow';

// App-specific types
import type { City } from '@/app/types/city';
import type { Restaurant } from '@/app/types/restaurant';

// Static data
import { COMMON_FOODS } from '@/app/data/constants/foods';
import { PRIORITY_ITEMS } from '@/app/data/constants/priorities';

// Generic utilities
import { withTimeout } from '@/utils/promise';
import { cn } from '@/lib/utils';
```

### File Naming Rules

- **Components**: PascalCase (e.g., `CitySelector.tsx`, `RestaurantCard.tsx`)
- **Hooks**: camelCase with 'use' prefix (e.g., `useCity.ts`, `useSearchFlow.ts`)
- **API Client**: REST convention (e.g., `cities.ts`, `foods.ts`, `recommendations.ts`)
- **Server Services**: `*Service.ts` (e.g., `restaurantService.ts`, `aiFoodService.ts`)
- **Types**: lowercase (e.g., `city.ts`, `restaurant.ts`)
- **Constants**: lowercase (e.g., `foods.ts`, `priorities.ts`)

### Component Structure Rules

```typescript
// 1. React imports
import { useState } from 'react';

// 2. Next.js imports
import Image from 'next/image';

// 3. Shared UI components (shadcn/ui)
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

// 4. App-specific components
import { CitySelector } from '@/app/components/search/CitySelector';

// 5. App-specific hooks
import { useCity } from '@/app/hooks/useCity';

// 6. Client-side API wrappers (if needed)
import { cityApi } from '@/app/api-client/cities';

// 7. Types
import type { City } from '@/app/types/city';

// 8. Utilities
import { cn } from '@/lib/utils';

// 9. Component definition
export function ComponentName() {
  // Component logic
}
```

### Service Layer Rules

**Client-Side API Calls** (`app/api-client/`):
- Use in client components and hooks only
- Function naming: `*Api()` (e.g., `cityApi()`, `foodApi()`)
- File naming: REST convention (e.g., `cities.ts`, `foods.ts`)

**Server-Side Business Logic** (`lib/server/`):
- Use in API routes only (`app/api/**/route.ts`)
- Function naming: `*Service` (e.g., `restaurantService`, `aiFoodService`)
- File naming: `*Service.ts` (e.g., `restaurantService.ts`)

## ğŸ¨ Styling Rules

### Tailwind CSS Class Order

1. **Layout**: `flex`, `grid`, `block`, `hidden`
2. **Position**: `relative`, `absolute`, `fixed`
3. **Size**: `w-`, `h-`, `max-w-`, `min-h-`
4. **Spacing**: `p-`, `m-`, `gap-`, `space-`
5. **Colors**: `bg-`, `text-`, `border-`
6. **Typography**: `text-`, `font-`, `leading-`
7. **Effects**: `shadow-`, `rounded-`, `opacity-`
8. **States**: `hover:`, `focus:`, `active:`

### Responsive Design

```typescript
// Mobile-first approach
<div className="flex flex-col gap-4 sm:flex-row lg:gap-8">
  <div className="w-full sm:w-1/2 lg:w-1/3">
    {/* Content */}
  </div>
</div>
```

#### shadcn/ui Integration

- Use `@/components/ui` for shadcn/ui components
- Follow shadcn/ui component patterns
- Use `cn()` utility for conditional classes
- Leverage Radix UI primitives for accessibility

## ğŸš€ Development Workflow

### 1. New Feature Development

1. **Global vs App-Specific Decision**: Consider if it will be used in other apps
2. **Folder Location Decision**: Choose appropriate location according to rules above
3. **Dependency Direction Check**: Global â†’ App-specific âœ…, App-specific â†’ Other apps âŒ
4. **Import Path Setting**: Use `@/` path for all imports

### 2. Component Creation

```typescript
// 1. Define types first
export interface ComponentProps {
  // props type definition
}

// 2. Write JSDoc comments directly above the component function
/**
 * Component description - be specific about what it does
 * @param {string} prop1 - prop1 description
 * @param {number} [prop2] - prop2 description (optional)
 */
export function ComponentName({ prop1, prop2 }: ComponentProps) {
  // Implementation
}

// 3. Set default values
ComponentName.defaultProps = {
  // default values
};
```

### 3. Hook Creation

```typescript
// 1. Define return type
export interface UseHookReturn {
  // return value type
}

// 2. Write JSDoc comments
/**
 * Hook description
 * @returns {UseHookReturn} return value description
 * @returns {string} returnValue.property1 - property1 description
 * @returns {Function} returnValue.method1 - method1 description
 */
export function useHookName(): UseHookReturn {
  // Implementation
}
```

## ğŸ“ Comment Rules

### JSDoc Comments Required

Write JSDoc comments for all functions, components, and hooks to quickly understand information.

**Important Rules:**

- JSDoc comments must be placed directly above the function/component, NOT above the interface
- Avoid generic descriptions like "Component props" - be specific about what the component does
- Use direct parameter names instead of `props.parameterName` format
- Only document parameters that need explanation - obvious parameters can be omitted

#### Function JSDoc Example

```typescript
/**
 * Custom hook for managing user search state
 * @returns {Object} search state and related functions
 * @returns {string} searchData.city - selected city
 * @returns {string} searchData.food - selected food
 * @returns {Object} searchData.priorities - priority settings
 * @returns {Function} updateSearch - function to update search data
 * @returns {Function} resetSearch - function to reset search data
 */
export function useSearch() {
  // Implementation...
}
```

#### Component JSDoc Example

```typescript
/**
 * City selection component for restaurant search
 * @param {Function} onCitySelect - callback when city is selected
 * @param {string} [defaultCity] - default selected city
 * @param {boolean} [disabled] - disabled state
 */
export function CitySelector({
  onCitySelect,
  defaultCity,
  disabled = false,
}: CitySelectorProps) {
  // Implementation...
}
```

#### API Function JSDoc Example

```typescript
/**
 * Search restaurant list through Google Places API
 * @param {string} city - city name to search
 * @param {string} food - food category to search
 * @param {Object} options - search options
 * @param {number} [options.limit=20] - result count limit
 * @param {string} [options.language='ko'] - language setting
 * @returns {Promise<Restaurant[]>} restaurant list Promise
 * @throws {Error} error when API call fails
 */
export async function searchRestaurants(
  city: string,
  food: string,
  options: SearchOptions = {}
): Promise<Restaurant[]> {
  // Implementation...
}
```

#### Utility Function JSDoc Example

```typescript
/**
 * Sort restaurant list by priority
 * @param {Restaurant[]} restaurants - restaurant list to sort
 * @param {PrioritySettings} priorities - priority settings
 * @returns {Restaurant[]} sorted restaurant list
 */
export function sortRestaurantsByPriority(
  restaurants: Restaurant[],
  priorities: PrioritySettings
): Restaurant[] {
  // Implementation...
}
```

### Korean Comments for Code

```typescript
// Hook for managing user search state
export function useSearch() {
  // City selection state
  const [selectedCity, setSelectedCity] = useState<string>('');

  // Search result state
  const [results, setResults] = useState<Restaurant[]>([]);
}
```

### English Strings for UI

```typescript
<Button>Search Restaurants</Button>
<h1>Find Your Perfect Restaurant</h1>
```

## ğŸ” Code Quality Rules

### TypeScript Strict Mode

- Follow `strict: true` setting
- Define types for all props and state
- Prohibit `any` type usage

### ESLint Rules

- Follow Prettier settings
- Maintain consistent code style
- Remove unused imports

### Performance Optimization

- Use `React.memo` appropriately
- Use `useMemo`, `useCallback` only when necessary
- Code splitting with dynamic imports

## ğŸš¨ Important Notes

### Prohibited Actions

- **Do not modify `src/components/ui/` folder directly** (shadcn/ui auto-generated)
- **Do not use `lib/server/` in client components** (server-only logic)
- **Do not use `app/api-client/` in API routes** (client-only wrappers)
- **Do not import app-specific components from other apps**

### Critical Separation Rules

1. **Client/Server Boundary**:
   - `app/api-client/*` â†’ Browser only (client components/hooks)
   - `lib/server/*` â†’ Server only (API routes)
   - `app/api/*` â†’ Server endpoints (Next.js API Routes)

2. **Component Organization**:
   - All app components â†’ `app/components/`
   - Pure UI library â†’ `components/ui/`

3. **Data Organization**:
   - Production constants â†’ `app/data/constants/`
   - Test/mock data â†’ `app/data/mocks/`

### Recommendations

- Follow single responsibility principle for components
- Keep client and server logic clearly separated
- Use appropriate naming conventions for each layer
- Ensure type safety through proper TypeScript types
- Document service layer boundaries clearly

Follow these rules to build a consistent and scalable codebase.
